
<!DOCTYPE html>
<html lang="tr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>HavaDurumuX - İnternetsiz Sürüm (Konsept)</title>
    <style>
        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Helvetica, Arial, sans-serif;
            margin: 0;
            padding: 20px;
            background-color: #f4f7f9;
            color: #333;
            line-height: 1.6;
        }
        .container {
            max-width: 800px;
            margin: 0 auto;
            background-color: #fff;
            padding: 20px;
            border-radius: 8px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
        }
        h1, h2 {
            color: #2c3e50;
        }
        select, button {
            padding: 10px 15px;
            margin-top: 10px;
            border-radius: 5px;
            border: 1px solid #ddd;
            font-size: 16px;
        }
        button {
            background-color: #3498db;
            color: white;
            cursor: pointer;
            transition: background-color 0.3s;
        }
        button:hover {
            background-color: #2980b9;
        }
        .weather-info {
            margin-top: 20px;
            padding: 15px;
            background-color: #ecf0f1;
            border-radius: 5px;
        }
        .weather-info p { margin: 5px 0; }
        .hourly-forecast { margin-top: 15px; }
        .hourly-item {
            padding: 8px;
            border-bottom: 1px solid #eee;
        }
        .hourly-item:last-child { border-bottom: none; }
        #status {
            margin-top: 15px;
            font-style: italic;
            color: #7f8c8d;
        }
        .temp-display {
            font-size: 2em;
            font-weight: bold;
        }
        .temp-trend {
            font-size: 0.9em;
            color: #555;
        }
        .footer-note {
            margin-top: 30px;
            text-align: center;
            font-size: 0.9em;
            color: #777;
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>HavaDurumuX - İnternetsiz Sürüm (Konsept)</h1>
        <p>Bu sayfa, HavaDurumuX'in potansiyel bir internetsiz sürümünün konseptini göstermektedir.</p>
        
        <label for="province-select">İl Seçin:</label>
        <select id="province-select">
            <option value="">-- İl Seçiniz --</option>
        </select>
        <button id="get-weather-btn">Hava Durumunu Getir/Yenile</button>
        <button id="clear-data-btn">Saklı Verileri Temizle</button>

        <div id="current-weather" class="weather-info" style="display:none;">
            <h2><span id="location-name"></span> - Anlık Hava Durumu</h2>
            <p class="temp-display"><span id="current-temp">--</span>°C</p>
            <p>Durum: <span id="current-condition">--</span></p>
            <p>Nem: <span id="current-humidity">--</span>%</p>
            <p>Rüzgar: <span id="current-wind">--</span> km/s</p>
            <p id="temp-change-info" class="temp-trend" style="display:none;">Sıcaklık değişimi: <span id="current-temp-dynamic">--</span>°C</p>
        </div>

        <div id="hourly-forecast-container" class="weather-info" style="display:none;">
            <h2>Saatlik Tahmin (İlk 66 Saat)</h2>
            <div id="hourly-forecast" class="hourly-forecast">
                <!-- Saatlik tahminler buraya eklenecek -->
            </div>
        </div>
        
        <p id="status">Durum: Hazır.</p>
        <p id="last-updated">Son Güncelleme: Veri Yok</p>

        <div class="footer-note">
            <p><strong>Not:</strong> Bu, tam işlevsel bir uygulama değildir. Tüm iller için veri çekme ve 6 saatte bir otomatik güncelleme gibi özellikler bu konseptte tam olarak uygulanmamıştır. API kullanım politikalarına dikkat edilmelidir.</p>
            <p>Gerçek bir çevrimdışı uygulama için daha gelişmiş teknikler (Service Worker, IndexedDB vb.) ve dikkatli bir API yönetimi gereklidir.</p>
        </div>
    </div>

    <script>
        const turkeyLocations = {
            // Koordinatlar örnek olarak verilmiştir, gerçek koordinatlar eklenmelidir.
            "Adana": { "Aladağ": { "lat": 37.54, "lon": 35.40 }, /* ...diğer ilçeler... */ "Seyhan": { "lat": 37.00, "lon": 35.32 } },
            "Ankara": { "Çankaya": { "lat": 39.92, "lon": 32.85 }, "Keçiören": { "lat": 39.98, "lon": 32.87 } },
            "Antalya": { "Muratpaşa": { "lat": 36.89, "lon": 30.70 }, "Alanya": { "lat": 36.54, "lon": 32.00 } },
            "Artvin": { "Merkez": { "lat": 41.18, "lon": 41.82 } },
            "Aydın": { "Efeler": { "lat": 37.84, "lon": 27.84 } },
            "Balıkesir": { "Karesi": { "lat": 39.65, "lon": 27.88 } },
            "Bilecik": { "Merkez": { "lat": 40.14, "lon": 29.98 } },
            "Bingöl": { "Merkez": { "lat": 38.88, "lon": 40.49 } },
            "Bitlis": { "Merkez": { "lat": 38.40, "lon": 42.11 } },
            "Bolu": { "Merkez": { "lat": 40.73, "lon": 31.60 } },
            "Burdur": { "Merkez": { "lat": 37.72, "lon": 30.28 } },
            "Bursa": { "Osmangazi": { "lat": 40.19, "lon": 29.06 } },
            "Çanakkale": { "Merkez": { "lat": 40.15, "lon": 26.41 } },
            "Çankırı": { "Merkez": { "lat": 40.60, "lon": 33.61 } },
            "Çorum": { "Merkez": { "lat": 40.55, "lon": 34.95 } },
            "Denizli": { "Pamukkale": { "lat": 37.78, "lon": 29.11 } },
            "Diyarbakır": { "Sur": { "lat": 37.91, "lon": 40.23 } },
            "Edirne": { "Merkez": { "lat": 41.67, "lon": 26.57 } },
            "Elazığ": { "Merkez": { "lat": 38.67, "lon": 39.22 } },
            "Erzincan": { "Merkez": { "lat": 39.74, "lon": 39.49 } },
            "Erzurum": { "Yakutiye": { "lat": 39.90, "lon": 41.27 } },
            "Eskişehir": { "Odunpazarı": { "lat": 39.77, "lon": 30.52 } },
            "Gaziantep": { "Şahinbey": { "lat": 37.06, "lon": 37.37 } },
            "Giresun": { "Merkez": { "lat": 40.91, "lon": 38.39 } },
            "Gümüşhane": { "Merkez": { "lat": 40.46, "lon": 39.48 } },
            "Hakkari": { "Merkez": { "lat": 37.57, "lon": 43.74 } },
            "Hatay": { "Antakya": { "lat": 36.20, "lon": 36.16 } },
            "Isparta": { "Merkez": { "lat": 37.76, "lon": 30.55 } },
            "Mersin": { "Akdeniz": { "lat": 36.81, "lon": 34.64 } },
            "İstanbul": { "Fatih": { "lat": 41.01, "lon": 28.97 }, "Kadıköy": {"lat": 40.99, "lon": 29.02} },
            "İzmir": { "Konak": { "lat": 38.42, "lon": 27.14 }, "Bornova": {"lat": 38.46, "lon": 27.22} },
            "Kars": { "Merkez": { "lat": 40.60, "lon": 43.09 } },
            "Kastamonu": { "Merkez": { "lat": 41.37, "lon": 33.78 } },
            "Kayseri": { "Kocasinan": { "lat": 38.73, "lon": 35.48 } },
            "Kırklareli": { "Merkez": { "lat": 41.73, "lon": 27.22 } },
            "Kırşehir": { "Merkez": { "lat": 39.14, "lon": 34.16 } },
            "Kocaeli": { "İzmit": { "lat": 40.76, "lon": 29.91 } },
            "Konya": { "Selçuklu": { "lat": 37.87, "lon": 32.49 } },
            "Kütahya": { "Merkez": { "lat": 39.4208, "lon": 29.9833 } }, // Örnek il
            "Malatya": { "Yeşilyurt": { "lat": 38.35, "lon": 38.30 } },
            "Manisa": { "Şehzadeler": { "lat": 38.61, "lon": 27.42 } },
            "Kahramanmaraş": { "Onikişubat": { "lat": 37.57, "lon": 36.92 } },
            "Mardin": { "Artuklu": { "lat": 37.31, "lon": 40.73 } },
            "Muğla": { "Menteşe": { "lat": 37.21, "lon": 28.36 } },
            "Muş": { "Merkez": { "lat": 38.73, "lon": 41.49 } },
            "Nevşehir": { "Merkez": { "lat": 38.62, "lon": 34.71 } },
            "Niğde": { "Merkez": { "lat": 37.96, "lon": 34.67 } },
            "Ordu": { "Altınordu": { "lat": 40.98, "lon": 37.87 } },
            "Rize": { "Merkez": { "lat": 41.02, "lon": 40.52 } },
            "Sakarya": { "Adapazarı": { "lat": 40.78, "lon": 30.40 } },
            "Samsun": { "İlkadım": { "lat": 41.28, "lon": 36.33 } },
            "Siirt": { "Merkez": { "lat": 37.93, "lon": 41.94 } },
            "Sinop": { "Merkez": { "lat": 42.02, "lon": 35.15 } },
            "Sivas": { "Merkez": { "lat": 39.75, "lon": 37.01 } },
            "Tekirdağ": { "Süleymanpaşa": { "lat": 40.97, "lon": 27.51 } },
            "Tokat": { "Merkez": { "lat": 40.32, "lon": 36.55 } },
            "Trabzon": { "Ortahisar": { "lat": 41.00, "lon": 39.72 } },
            "Tunceli": { "Merkez": { "lat": 39.10, "lon": 39.54 } },
            "Şanlıurfa": { "Haliliye": { "lat": 37.16, "lon": 38.79 } },
            "Uşak": { "Merkez": { "lat": 38.68, "lon": 29.40 } },
            "Van": { "İpekyolu": { "lat": 38.50, "lon": 43.37 } },
            "Yozgat": { "Merkez": { "lat": 39.82, "lon": 34.80 } },
            "Zonguldak": { "Merkez": { "lat": 41.45, "lon": 31.79 } },
            "Aksaray": { "Merkez": { "lat": 38.37, "lon": 34.03 } },
            "Bayburt": { "Merkez": { "lat": 40.25, "lon": 40.22 } },
            "Karaman": { "Merkez": { "lat": 37.18, "lon": 33.22 } },
            "Kırıkkale": { "Merkez": { "lat": 39.84, "lon": 33.51 } },
            "Batman": { "Merkez": { "lat": 37.88, "lon": 41.13 } },
            "Şırnak": { "Merkez": { "lat": 37.51, "lon": 42.46 } },
            "Bartın": { "Merkez": { "lat": 41.63, "lon": 32.33 } },
            "Ardahan": { "Merkez": { "lat": 41.11, "lon": 42.70 } },
            "Iğdır": { "Merkez": { "lat": 39.92, "lon": 44.04 } },
            "Yalova": { "Merkez": { "lat": 40.65, "lon": 29.27 } },
            "Karabük": { "Merkez": { "lat": 41.20, "lon": 32.62 } },
            "Kilis": { "Merkez": { "lat": 36.71, "lon": 37.11 } },
            "Osmaniye": { "Merkez": { "lat": 37.07, "lon": 36.24 } },
            "Düzce": { "Merkez": { "lat": 40.84, "lon": 31.15 } }
        };

        const provinceSelect = document.getElementById('province-select');
        const getWeatherBtn = document.getElementById('get-weather-btn');
        const clearDataBtn = document.getElementById('clear-data-btn');
        const statusDiv = document.getElementById('status');
        const lastUpdatedDiv = document.getElementById('last-updated');
        
        const currentTempDisplay = document.getElementById('current-temp');
        const currentTempDynamicDisplay = document.getElementById('current-temp-dynamic');
        const tempChangeInfoDiv = document.getElementById('temp-change-info');
        const currentConditionDisplay = document.getElementById('current-condition');
        const currentHumidityDisplay = document.getElementById('current-humidity');
        const currentWindDisplay = document.getElementById('current-wind');
        const locationNameDisplay = document.getElementById('location-name');
        const currentWeatherDiv = document.getElementById('current-weather');
        const hourlyForecastContainerDiv = document.getElementById('hourly-forecast-container');
        const hourlyForecastDiv = document.getElementById('hourly-forecast');

        const MET_API_BASE_URL = 'https://api.met.no/weatherapi/locationforecast/2.0/compact';
        const MET_USER_AGENT = 'havadurumuxsite-offline/1.0 havadurumux@gmail.com';
        const CACHE_EXPIRY_MS = 6 * 60 * 60 * 1000; // 6 saat
        const ACTIVE_PROVINCE_KEY = 'havadurumux_offline_active_province';

        let tempAnimationInterval = null;

        // Populate province dropdown
        for (const province in turkeyLocations) {
            const option = document.createElement('option');
            option.value = province;
            option.textContent = province;
            provinceSelect.appendChild(option);
        }
        
        // MET.no symbol_code to WMO code and description
        const metSymbolToWeatherInfo = {
            'clearsky_day': { wmo: 0, desc: 'Açık' }, 'clearsky_night': { wmo: 0, desc: 'Açık (Gece)' },
            'fair_day': { wmo: 1, desc: 'Az Bulutlu' }, 'fair_night': { wmo: 1, desc: 'Az Bulutlu (Gece)' },
            'partlycloudy_day': { wmo: 2, desc: 'Parçalı Bulutlu' }, 'partlycloudy_night': { wmo: 2, desc: 'Parçalı Bulutlu (Gece)' },
            'cloudy': { wmo: 3, desc: 'Bulutlu' },
            'lightrainshowers_day': { wmo: 80, desc: 'Hafif Sağanak Yağmur' }, 'lightrainshowers_night': { wmo: 80, desc: 'Hafif Sağanak Yağmur (Gece)' },
            'rainshowers_day': { wmo: 81, desc: 'Sağanak Yağmur' }, 'rainshowers_night': { wmo: 81, desc: 'Sağanak Yağmur (Gece)' },
            'heavyrainshowers_day': { wmo: 82, desc: 'Şiddetli Sağanak Yağmur' }, 'heavyrainshowers_night': { wmo: 82, desc: 'Şiddetli Sağanak Yağmur (Gece)' },
            'lightrain': { wmo: 61, desc: 'Hafif Yağmur' }, 'rain': { wmo: 63, desc: 'Yağmur' }, 'heavyrain': { wmo: 65, desc: 'Şiddetli Yağmur' },
            'lightsnow': { wmo: 71, desc: 'Hafif Kar' }, 'snow': { wmo: 73, desc: 'Kar' }, 'heavysnow': { wmo: 75, desc: 'Yoğun Kar' },
            'fog': { wmo: 45, desc: 'Sisli' },
            // Daha fazla kod eklenebilir...
            'default': { wmo: -1, desc: 'Bilinmiyor'}
        };

        function getWeatherDescription(symbolCode) {
            if (!symbolCode) return metSymbolToWeatherInfo['default'].desc;
            const code = symbolCode.toLowerCase();
            return (metSymbolToWeatherInfo[code] || metSymbolToWeatherInfo['default']).desc;
        }


        async function fetchWeatherData(lat, lon) {
            statusDiv.textContent = 'Hava durumu verileri alınıyor...';
            try {
                const response = await fetch(`${MET_API_BASE_URL}?lat=${lat}&lon=${lon}`, {
                    headers: { 'User-Agent': MET_USER_AGENT },
                });
                if (!response.ok) {
                    throw new Error(`API isteği başarısız: ${response.status} ${response.statusText}`);
                }
                const data = await response.json();
                statusDiv.textContent = 'Veriler başarıyla alındı.';
                return data;
            } catch (error) {
                console.error('Hava durumu alınamadı:', error);
                statusDiv.textContent = `Hata: ${error.message}`;
                return null;
            }
        }

        function processAndStoreWeatherData(provinceName, rawData) {
            if (!rawData || !rawData.properties || !rawData.properties.timeseries) {
                console.error("Geçersiz MET.no verisi:", rawData);
                statusDiv.textContent = "Alınan veri formatı hatalı.";
                return;
            }

            const now = new Date();
            const forecastLimit = new Date(now.getTime() + 66 * 60 * 60 * 1000); // 66 saat sonrası

            const relevantTimeseries = rawData.properties.timeseries.filter(ts => {
                const time = new Date(ts.time);
                return time >= now && time <= forecastLimit;
            });
            
            if (relevantTimeseries.length === 0) {
                 statusDiv.textContent = "Gelecek 66 saat için uygun tahmin verisi bulunamadı.";
                 return;
            }

            const currentData = relevantTimeseries[0].data.instant.details;
            const nextHourData = relevantTimeseries.length > 1 ? relevantTimeseries[1].data.instant.details : null;
            const currentSymbol = relevantTimeseries[0].data.next_1_hours?.summary?.symbol_code || 
                                  relevantTimeseries[0].data.next_6_hours?.summary?.symbol_code || 
                                  'default';


            const processedData = {
                location: provinceName,
                updatedAt: new Date().toISOString(),
                current: {
                    temp: currentData.air_temperature,
                    condition: getWeatherDescription(currentSymbol),
                    humidity: currentData.relative_humidity,
                    windSpeed: currentData.wind_speed !== undefined ? (currentData.wind_speed * 3.6).toFixed(1) : 'N/A', // m/s to km/h
                    windDirection: currentData.wind_from_direction,
                    nextHourTemp: nextHourData ? nextHourData.air_temperature : null
                },
                hourly: relevantTimeseries.map((ts, index) => {
                    const details = ts.data.instant.details;
                    const symbol = ts.data.next_1_hours?.summary?.symbol_code || 
                                   ts.data.next_6_hours?.summary?.symbol_code || 
                                   'default';
                    const nextTs = relevantTimeseries[index + 1];
                    return {
                        time: ts.time,
                        temp: details.air_temperature,
                        condition: getWeatherDescription(symbol),
                        humidity: details.relative_humidity,
                        windSpeed: details.wind_speed !== undefined ? (details.wind_speed * 3.6).toFixed(1) : 'N/A',
                        nextHourTemp: nextTs ? nextTs.data.instant.details.air_temperature : null
                    };
                })
            };

            try {
                localStorage.setItem(`weather_${provinceName}`, JSON.stringify(processedData));
                localStorage.setItem(ACTIVE_PROVINCE_KEY, provinceName);
                statusDiv.textContent = `${provinceName} için veriler saklandı.`;
                displayWeatherData(processedData);
            } catch (e) {
                console.error("LocalStorage'a kaydetme hatası:", e);
                statusDiv.textContent = "Veriler saklanamadı (LocalStorage dolu olabilir).";
            }
        }
        
        function displayWeatherData(data) {
            if (!data) {
                currentWeatherDiv.style.display = 'none';
                hourlyForecastContainerDiv.style.display = 'none';
                lastUpdatedDiv.textContent = 'Son Güncelleme: Veri Yok';
                return;
            }

            locationNameDisplay.textContent = data.location;
            currentTempDisplay.textContent = data.current.temp !== undefined ? data.current.temp.toFixed(1) : '--';
            currentConditionDisplay.textContent = data.current.condition || '--';
            currentHumidityDisplay.textContent = data.current.humidity !== undefined ? data.current.humidity.toFixed(0) : '--';
            currentWindDisplay.textContent = data.current.windSpeed || '--';
            
            currentWeatherDiv.style.display = 'block';
            lastUpdatedDiv.textContent = `Son Güncelleme: ${new Date(data.updatedAt).toLocaleString('tr-TR')}`;

            hourlyForecastDiv.innerHTML = ''; // Clear previous forecast
            if (data.hourly && data.hourly.length > 0) {
                hourlyForecastContainerDiv.style.display = 'block';
                data.hourly.slice(0, 66).forEach(hour => { // Sadece ilk 66 saati göster
                    const item = document.createElement('div');
                    item.classList.add('hourly-item');
                    const time = new Date(hour.time);
                    item.innerHTML = `
                        <strong>${time.toLocaleTimeString('tr-TR', { hour: '2-digit', minute: '2-digit' })} (${time.toLocaleDateString('tr-TR', { weekday: 'short' })})</strong><br>
                        Sıcaklık: ${hour.temp !== undefined ? hour.temp.toFixed(1) : '--'}°C, Durum: ${hour.condition || '--'}, Nem: ${hour.humidity !== undefined ? hour.humidity.toFixed(0) : '--'}%, Rüzgar: ${hour.windSpeed || '--'} km/s
                    `;
                    hourlyForecastDiv.appendChild(item);
                });
            } else {
                hourlyForecastContainerDiv.style.display = 'none';
            }
            
            // Sıcaklık animasyonu
            startTemperatureAnimation(data.current.temp, data.current.nextHourTemp);
        }

        function startTemperatureAnimation(currentTemp, nextHourTemp) {
            if (tempAnimationInterval) clearInterval(tempAnimationInterval);
            
            if (typeof currentTemp !== 'number' || typeof nextHourTemp !== 'number') {
                tempChangeInfoDiv.style.display = 'none';
                return;
            }

            tempChangeInfoDiv.style.display = 'block';
            currentTempDynamicDisplay.textContent = currentTemp.toFixed(1);

            const diff = nextHourTemp - currentTemp;
            const steps = 60 * 60; // saniye cinsinden 1 saat
            const changePerStep = diff / steps; // Her saniyedeki değişim
            let animatedTemp = currentTemp;
            let stepsElapsed = 0;

            // Animasyon her 10 saniyede bir güncellensin (toplamda 360 adım)
            // Gerçek bir saatlik animasyon tarayıcıyı yorabilir.
            // Bu, konseptin bir simülasyonudur.
            const animationSteps = 360; // 10 saniyede bir güncelleme, 1 saat için 360 adım.
            const displayChangePerStep = diff / animationSteps;


            tempAnimationInterval = setInterval(() => {
                stepsElapsed++;
                if (stepsElapsed > animationSteps) {
                    clearInterval(tempAnimationInterval);
                    currentTempDynamicDisplay.textContent = nextHourTemp.toFixed(1);
                    // Bir sonraki saatin verilerini yükle ve animasyonu yeniden başlat (opsiyonel)
                    // updateToNextHour(); // Bu fonksiyonun implementasyonu gerekir
                    return;
                }
                animatedTemp += displayChangePerStep;
                currentTempDynamicDisplay.textContent = animatedTemp.toFixed(1);
            }, 10000); // Her 10 saniyede bir güncelle.
        }

        async function loadAndDisplayWeather() {
            const selectedProvince = provinceSelect.value;
            if (!selectedProvince) {
                statusDiv.textContent = 'Lütfen bir il seçin.';
                return;
            }
             // Örnek olarak Kütahya Merkez seçildi, normalde ilçe de seçtirmek gerekebilir.
            const locationData = turkeyLocations[selectedProvince]?.Merkez || turkeyLocations[selectedProvince]?.[Object.keys(turkeyLocations[selectedProvince])[0]];

            if (!locationData) {
                statusDiv.textContent = 'Seçilen il için koordinat bulunamadı.';
                return;
            }

            const cachedDataString = localStorage.getItem(`weather_${selectedProvince}`);
            if (cachedDataString) {
                const cachedData = JSON.parse(cachedDataString);
                const lastUpdate = new Date(cachedData.updatedAt).getTime();
                if (new Date().getTime() - lastUpdate < CACHE_EXPIRY_MS) {
                    statusDiv.textContent = `${selectedProvince} için saklanan veriler yükleniyor...`;
                    displayWeatherData(cachedData);
                    return;
                } else {
                    statusDiv.textContent = `${selectedProvince} için saklanan verilerin süresi dolmuş. Yenisi çekiliyor...`;
                }
            }

            const rawData = await fetchWeatherData(locationData.lat, locationData.lon);
            if (rawData) {
                processAndStoreWeatherData(selectedProvince, rawData);
            }
        }

        getWeatherBtn.addEventListener('click', loadAndDisplayWeather);

        clearDataBtn.addEventListener('click', () => {
            const selectedProvince = provinceSelect.value;
            if (selectedProvince) {
                localStorage.removeItem(`weather_${selectedProvince}`);
                statusDiv.textContent = `${selectedProvince} için saklanan veriler temizlendi.`;
                if (localStorage.getItem(ACTIVE_PROVINCE_KEY) === selectedProvince) {
                     localStorage.removeItem(ACTIVE_PROVINCE_KEY);
                }
            } else {
                 const active = localStorage.getItem(ACTIVE_PROVINCE_KEY);
                 if (active) localStorage.removeItem(`weather_${active}`);
                 localStorage.removeItem(ACTIVE_PROVINCE_KEY);
                 localStorage.clear(); // Tümünü temizle
                 statusDiv.textContent = 'Tüm saklı hava durumu verileri temizlendi.';
            }
            displayWeatherData(null); // Ekranı temizle
        });
        
        // Sayfa yüklendiğinde son aktif ili yükle
        window.addEventListener('load', () => {
            const lastActiveProvince = localStorage.getItem(ACTIVE_PROVINCE_KEY);
            if (lastActiveProvince && turkeyLocations[lastActiveProvince]) {
                provinceSelect.value = lastActiveProvince;
                loadAndDisplayWeather();
            } else if (turkeyLocations["Kütahya"]) { // Varsayılan olarak Kütahya'yı yükle
                provinceSelect.value = "Kütahya";
                loadAndDisplayWeather();
            }
        });

        // Otomatik yenileme mantığı (konsept)
        // Gerçek bir uygulamada bu daha karmaşık olmalı ve API limitlerine dikkat etmeli
        /*
        setInterval(() => {
            console.log("Otomatik veri yenileme kontrolü (6 saatte bir - konsept)...");
            const activeProvince = localStorage.getItem(ACTIVE_PROVINCE_KEY);
            if (activeProvince) {
                const cachedDataString = localStorage.getItem(`weather_${activeProvince}`);
                if (cachedDataString) {
                    const cachedData = JSON.parse(cachedDataString);
                    const lastUpdate = new Date(cachedData.updatedAt).getTime();
                    if (new Date().getTime() - lastUpdate >= CACHE_EXPIRY_MS) {
                        console.log(`${activeProvince} için veriler güncelleniyor...`);
                        const locationData = turkeyLocations[activeProvince]?.Merkez || turkeyLocations[activeProvince]?.[Object.keys(turkeyLocations[activeProvince])[0]];
                        if(locationData) {
                           fetchWeatherData(locationData.lat, locationData.lon).then(rawData => {
                               if(rawData) processAndStoreWeatherData(activeProvince, rawData);
                           });
                        }
                    }
                }
            }
        }, CACHE_EXPIRY_MS); // 6 saatte bir kontrol et
        */
         // API Limitleri ve Kullanıcı Deneyimi:
        // 81 il için her 10 saniyede bir istek yapmak MET.no gibi API'ler için genellikle kabul edilebilir değildir
        // ve rate limiting'e yol açabilir. Ayrıca 13.5 dakika boyunca sürekli istek göndermek
        // kullanıcı tarafında da kaynak tüketimine (batarya, veri) neden olabilir.
        //
        // Önerilen Yaklaşım (Gerçek Uygulama için):
        // 1. Kullanıcının aktif olarak baktığı veya favori olarak işaretlediği birkaç il için veri çekmek.
        // 2. Service Worker kullanarak arka planda periyodik güncellemeler yapmak (kullanıcı sayfayı kapatsa bile).
        // 3. Verileri daha verimli saklamak için IndexedDB kullanmak (localStorage limitleri aşılabilir).
        // 4. API sağlayıcısının koşullarına uygun, daha seyrek ama etkili güncelleme stratejileri geliştirmek.
        //    Örneğin, tüm iller için çok temel bir özet veriyi daha seyrek, aktif il için detaylı veriyi daha sık çekmek.
    </script>
</body>
</html>
